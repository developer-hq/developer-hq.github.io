<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://developer-hq.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://developer-hq.github.io/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 6.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/11/24/Multi-HeadedAttention/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/11/24/Multi-HeadedAttention/" itemprop="url">Multi-HeadedAttention</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-11-24T14:17:12+08:00">
                2023-11-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a target="_blank" rel="noopener" href="https://nn.labml.ai/transformers/mha.html">https://nn.labml.ai/transformers/mha.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/11/24/MHA-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/11/24/MHA-1/" itemprop="url">(MHA)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-11-24T14:16:58+08:00">
                2023-11-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/11/24/MHA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/11/24/MHA/" itemprop="url">(MHA)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-11-24T14:15:49+08:00">
                2023-11-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/11/21/Latex-0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/11/21/Latex-0/" itemprop="url">Latex</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-11-21T23:42:27+08:00">
                2023-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/10/31/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/10/31/%E7%9F%A5%E8%AF%86%E5%BA%93%E6%90%AD%E5%BB%BA/" itemprop="url">知识库搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-10-31T16:45:55+08:00">
                2023-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>1.采用chatglm2</p>
<p><a target="_blank" rel="noopener" href="https://github.com/THUDM/ChatGLM2-6B">https://github.com/THUDM/ChatGLM2-6B</a></p>
<p>2.langchain搭建本地知识库</p>
<p><a target="_blank" rel="noopener" href="https://github.com/iMagist486/ElasticSearch-Langchain-Chatglm2">https://github.com/iMagist486/ElasticSearch-Langchain-Chatglm2</a></p>
<p>联网搜索？</p>
<p><a target="_blank" rel="noopener" href="https://github.com/GaiZhenbiao/ChuanhuChatGPT">https://github.com/GaiZhenbiao/ChuanhuChatGPT</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/10/25/Screeps/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/10/25/Screeps/" itemprop="url">Screeps</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-10-25T20:17:07+08:00">
                2023-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h1><h3 id="1-basic"><a href="#1-basic" class="headerlink" title="1.basic"></a>1.basic</h3><p>获取creep</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Game.spawns[&#x27;Spawn1&#x27;].spawnCreep( [WORK, CARRY, MOVE], &#x27;Harvester1&#x27; );</span><br></pre></td></tr></table></figure>

<p>采矿</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports.loop = function () &#123;</span><br><span class="line">    var creep = Game.creeps[&#x27;Harvester1&#x27;];</span><br><span class="line">    var sources = creep.room.find(FIND_SOURCES);</span><br><span class="line">    if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">        creep.moveTo(sources[0]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多个creep</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">module.exports.loop = function () &#123;</span><br><span class="line">    for(var name in Game.creeps) &#123;</span><br><span class="line">        var creep = Game.creeps[name];</span><br><span class="line"></span><br><span class="line">        if(creep.store.getFreeCapacity() &gt; 0) &#123;</span><br><span class="line">            var sources = creep.room.find(FIND_SOURCES);</span><br><span class="line">            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                creep.moveTo(sources[0]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            if(creep.transfer(Game.spawns[&#x27;Spawn1&#x27;], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                creep.moveTo(Game.spawns[&#x27;Spawn1&#x27;]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建模块role.harvester</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = &#123;</span><br><span class="line"></span><br><span class="line">    /** @param &#123;Creep&#125; creep **/</span><br><span class="line">    run: function(creep) &#123;</span><br><span class="line">	    if(creep.store.getFreeCapacity() &gt; 0) &#123;</span><br><span class="line">            var sources = creep.room.find(FIND_SOURCES);</span><br><span class="line">            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                creep.moveTo(sources[0]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            if(creep.transfer(Game.spawns[&#x27;Spawn1&#x27;], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                creep.moveTo(Game.spawns[&#x27;Spawn1&#x27;]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module.exports = roleHarvester;</span><br></pre></td></tr></table></figure>

<p>主函数调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = require(&#x27;role.harvester&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports.loop = function () &#123;</span><br><span class="line"></span><br><span class="line">    for(var name in Game.creeps) &#123;</span><br><span class="line">        var creep = Game.creeps[name];</span><br><span class="line">        roleHarvester.run(creep);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-upgrading-controller"><a href="#2-upgrading-controller" class="headerlink" title="2.upgrading controller"></a>2.upgrading controller</h3><p>升级控制器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Game.spawns[&#x27;Spawn1&#x27;].spawnCreep( [WORK, CARRY, MOVE], &#x27;Upgrader1&#x27; );</span><br></pre></td></tr></table></figure>

<p>把role写到内存里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Game.creeps[&#x27;Harvester1&#x27;].memory.role = &#x27;harvester&#x27;; </span><br><span class="line">Game.creeps[&#x27;Upgrader1&#x27;].memory.role = &#x27;upgrader&#x27;;</span><br></pre></td></tr></table></figure>

<p>role.upgrader</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var roleUpgrader = &#123;</span><br><span class="line"></span><br><span class="line">    /** @param &#123;Creep&#125; creep **/</span><br><span class="line">    run: function(creep) &#123;</span><br><span class="line">	    if(creep.store[RESOURCE_ENERGY] == 0) &#123;</span><br><span class="line">            var sources = creep.room.find(FIND_SOURCES);</span><br><span class="line">            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                creep.moveTo(sources[0]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            if(creep.upgradeController(creep.room.controller) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                creep.moveTo(creep.room.controller);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module.exports = roleUpgrader;</span><br></pre></td></tr></table></figure>

<p>修改main，让upgrader上线</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = require(&#x27;role.harvester&#x27;);</span><br><span class="line">var roleUpgrader = require(&#x27;role.upgrader&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports.loop = function () &#123;</span><br><span class="line"></span><br><span class="line">    for(var name in Game.creeps) &#123;</span><br><span class="line">        var creep = Game.creeps[name];</span><br><span class="line">        if(creep.memory.role == &#x27;harvester&#x27;) &#123;</span><br><span class="line">            roleHarvester.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">        if(creep.memory.role == &#x27;upgrader&#x27;) &#123;</span><br><span class="line">            roleUpgrader.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如此就升级了controller</p>
<p>重要提示： 如果您没有在 20,000 个游戏时间内升级控制器，它就会降低一级。达到 0 级时，您将失去对房间的控制，其他玩家将可以自由占领房间。确保至少有一个小兵定期执行升级控制器功能。</p>
<h3 id="3-建东西"><a href="#3-建东西" class="headerlink" title="3.建东西"></a>3.建东西</h3><p>控制器升级后可以使用一些新结构：城墙、城垛和延伸部分。我们将在下一节教程中讨论城墙和城垛，现在让我们来谈谈扩展部分。要建造更大的蠕虫，就需要扩展部分。只有一种身体部位的蠕虫效果很差。赋予它多个工作部位会使它的工作速度成比例地提高。然而，这样的蠕虫成本很高，一个单独的产卵只能包含 300 个能量单位。如果要建造超过 300 能量单位的蠕虫，就需要对产卵进行扩展。</p>
<p>第二个 “控制器 “关卡有 5 个扩展项供您建造。每个新关卡都会增加这一数量。</p>
<p>您可以在房间的任意位置放置扩展装置，而且无论距离多远，都可以使用它们。在本教程中，我们已经放置了相应的建筑地点，以方便您的使用。</p>
<p>生成builder</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Game.spawns[&#x27;Spawn1&#x27;].spawnCreep( [WORK, CARRY, MOVE], &#x27;Builder1&#x27;,</span><br><span class="line">    &#123; memory: &#123; role: &#x27;builder&#x27; &#125; &#125; );</span><br></pre></td></tr></table></figure>

<p>定义role.builder</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">var roleBuilder = &#123;</span><br><span class="line"></span><br><span class="line">    /** @param &#123;Creep&#125; creep **/</span><br><span class="line">    run: function(creep) &#123;</span><br><span class="line"></span><br><span class="line">	    if(creep.memory.building &amp;&amp; creep.store[RESOURCE_ENERGY] == 0) &#123;</span><br><span class="line">            creep.memory.building = false;</span><br><span class="line">            creep.say(&#x27;🔄 harvest&#x27;);</span><br><span class="line">	    &#125;</span><br><span class="line">	    if(!creep.memory.building &amp;&amp; creep.store.getFreeCapacity() == 0) &#123;</span><br><span class="line">	        creep.memory.building = true;</span><br><span class="line">	        creep.say(&#x27;🚧 build&#x27;);</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">	    if(creep.memory.building) &#123;</span><br><span class="line">	        var targets = creep.room.find(FIND_CONSTRUCTION_SITES);</span><br><span class="line">            if(targets.length) &#123;</span><br><span class="line">                if(creep.build(targets[0]) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                    creep.moveTo(targets[0], &#123;visualizePathStyle: &#123;stroke: &#x27;#ffffff&#x27;&#125;&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">	    &#125;</span><br><span class="line">	    else &#123;</span><br><span class="line">	        var sources = creep.room.find(FIND_SOURCES);</span><br><span class="line">            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                creep.moveTo(sources[0], &#123;visualizePathStyle: &#123;stroke: &#x27;#ffaa00&#x27;&#125;&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module.exports = roleBuilder;</span><br></pre></td></tr></table></figure>

<p>main调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = require(&#x27;role.harvester&#x27;);</span><br><span class="line">var roleBuilder = require(&#x27;role.builder&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports.loop = function () &#123;</span><br><span class="line"></span><br><span class="line">    for(var name in Game.creeps) &#123;</span><br><span class="line">        var creep = Game.creeps[name];</span><br><span class="line">        if(creep.memory.role == &#x27;harvester&#x27;) &#123;</span><br><span class="line">            roleHarvester.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">        if(creep.memory.role == &#x27;builder&#x27;) &#123;</span><br><span class="line">            roleBuilder.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要维护扩展空间，就需要让收割机不仅能将能量输送到产卵点，还能将能量输送到扩展空间。为此，您可以使用 Game.structures 对象，或者借助 Room.find(FIND_STRUCTURES) 在房间内搜索。在这两种情况下，您都需要根据 structure.structureType == STRUCTURE_EXTENSION（或者，structure instanceof StructureExtension）这一条件来过滤项目列表，并像之前一样检查它们的能量负载。</p>
<p>修改role.harvest</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = &#123;</span><br><span class="line"></span><br><span class="line">    /** @param &#123;Creep&#125; creep **/</span><br><span class="line">    run: function(creep) &#123;</span><br><span class="line">	    if(creep.store.getFreeCapacity() &gt; 0) &#123;</span><br><span class="line">            var sources = creep.room.find(FIND_SOURCES);</span><br><span class="line">            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                creep.moveTo(sources[0], &#123;visualizePathStyle: &#123;stroke: &#x27;#ffaa00&#x27;&#125;&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            var targets = creep.room.find(FIND_STRUCTURES, &#123;</span><br><span class="line">                    filter: (structure) =&gt; &#123;</span><br><span class="line">                        return (structure.structureType == STRUCTURE_EXTENSION || structure.structureType == STRUCTURE_SPAWN) &amp;&amp;</span><br><span class="line">                            structure.store.getFreeCapacity(RESOURCE_ENERGY) &gt; 0;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            if(targets.length &gt; 0) &#123;</span><br><span class="line">                if(creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                    creep.moveTo(targets[0], &#123;visualizePathStyle: &#123;stroke: &#x27;#ffffff&#x27;&#125;&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module.exports = roleHarvester;</span><br></pre></td></tr></table></figure>

<p>要了解房间内的能源总量，可以使用 Room.energyAvailable 属性。让我们将该属性的输出添加到控制台中，以便在填充扩展程序时对其进行跟踪。</p>
<p>为所有 5 个分机和再生器注入能量。</p>
<p>我们的卵子和延伸体总共有 550 个能量单位。这些能量足以建造一个身体为[WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE]的蠕虫。这种蠕虫的工作速度是普通蠕虫的 4 倍。它的身体更重，所以我们要再给它增加一个 MOVE。不过，两部分的移动速度仍不足以达到小型快速蠕虫的移动速度，因为小型快速蠕虫需要 4 倍移动或修建道路。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Game.spawns[&#x27;Spawn1&#x27;].spawnCreep( [WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE],</span><br><span class="line">    &#x27;HarvesterBig&#x27;,</span><br><span class="line">    &#123; memory: &#123; role: &#x27;harvester&#x27; &#125; &#125; );</span><br></pre></td></tr></table></figure>

<p>因此，通过升级您的控制器、建造新的扩展设备和更强大的小兵，您可以大大提高殖民地工作的效率。此外，用更少的大型蠕虫取代大量的小型蠕虫，还能节省控制它们所需的 CPU 资源，而这正是在线模式的重要前提。</p>
<p>下一节，我们将讨论如何设置自动制造新蠕虫。</p>
<h3 id="4-自动造screeps"><a href="#4-自动造screeps" class="headerlink" title="4.自动造screeps"></a>4.自动造screeps</h3><p>到目前为止，我们都是直接在控制台中创建新的蠕虫。经常这样做并不是个好主意，因为 “蠕虫 “的理念就是让你的蚁群自己控制自己。如果你能教会你的 “卵 “自己在房间里制造蠕虫，你就会做得很好。</p>
<p>这是一个相当复杂的话题，许多玩家花费数月时间来完善和改进他们的自动生成代码。但让我们至少尝试一些简单的方法，并掌握一些基本原则。</p>
<p>当老的蠕虫因年龄或其他原因死亡时，您就必须创建新的蠕虫。由于游戏中没有报告特定小兵死亡的事件，最简单的方法就是计算所需小兵的数量，如果少于规定值，就开始制造。</p>
<p>有几种方法可以计算所需类型的蠕虫数量。其中一种方法是借助 _.filter 函数过滤 Game.creeps，并使用其内存中的角色。让我们试着这样做，并在控制台中显示小人的数量。</p>
<p>在控制台中加入使用角色收割机计算的小兵数量输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = require(&#x27;role.harvester&#x27;);</span><br><span class="line">var roleUpgrader = require(&#x27;role.upgrader&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports.loop = function () &#123;</span><br><span class="line"></span><br><span class="line">    var harvesters = _.filter(Game.creeps, (creep) =&gt; creep.memory.role == &#x27;harvester&#x27;);</span><br><span class="line">    console.log(&#x27;Harvesters: &#x27; + harvesters.length);</span><br><span class="line"></span><br><span class="line">    for(var name in Game.creeps) &#123;</span><br><span class="line">        var creep = Game.creeps[name];</span><br><span class="line">        if(creep.memory.role == &#x27;harvester&#x27;) &#123;</span><br><span class="line">            roleHarvester.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">        if(creep.memory.role == &#x27;upgrader&#x27;) &#123;</span><br><span class="line">            roleUpgrader.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>比方说，我们希望在任何时候都至少有两台收割机。最简单的方法就是每次发现少于这个数量时运行 StructureSpawn.spawnCreep。您可以不定义其名称（在这种情况下会自动给出），但不要忘记定义所需的角色。</p>
<p>我们还可以添加一些新的 RoomVisual 调用，以便可视化正在生成的蠕虫。</p>
<p>在主模块中添加 StructureSpawn.spawnCreep 的逻辑。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = require(&#x27;role.harvester&#x27;);</span><br><span class="line">var roleUpgrader = require(&#x27;role.upgrader&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports.loop = function () &#123;</span><br><span class="line"></span><br><span class="line">    var harvesters = _.filter(Game.creeps, (creep) =&gt; creep.memory.role == &#x27;harvester&#x27;);</span><br><span class="line">    console.log(&#x27;Harvesters: &#x27; + harvesters.length);</span><br><span class="line"></span><br><span class="line">    if(harvesters.length &lt; 2) &#123;</span><br><span class="line">        var newName = &#x27;Harvester&#x27; + Game.time;</span><br><span class="line">        console.log(&#x27;Spawning new harvester: &#x27; + newName);</span><br><span class="line">        Game.spawns[&#x27;Spawn1&#x27;].spawnCreep([WORK,CARRY,MOVE], newName, </span><br><span class="line">            &#123;memory: &#123;role: &#x27;harvester&#x27;&#125;&#125;);        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if(Game.spawns[&#x27;Spawn1&#x27;].spawning) &#123; </span><br><span class="line">        var spawningCreep = Game.creeps[Game.spawns[&#x27;Spawn1&#x27;].spawning.name];</span><br><span class="line">        Game.spawns[&#x27;Spawn1&#x27;].room.visual.text(</span><br><span class="line">            &#x27;🛠️&#x27; + spawningCreep.memory.role,</span><br><span class="line">            Game.spawns[&#x27;Spawn1&#x27;].pos.x + 1, </span><br><span class="line">            Game.spawns[&#x27;Spawn1&#x27;].pos.y, </span><br><span class="line">            &#123;align: &#x27;left&#x27;, opacity: 0.8&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for(var name in Game.creeps) &#123;</span><br><span class="line">        var creep = Game.creeps[name];</span><br><span class="line">        if(creep.memory.role == &#x27;harvester&#x27;) &#123;</span><br><span class="line">            roleHarvester.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">        if(creep.memory.role == &#x27;upgrader&#x27;) &#123;</span><br><span class="line">            roleUpgrader.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，让我们来模拟收割机死亡的情况。现在，你可以通过控制台或右侧的属性面板向蠕虫发出自杀命令。</p>
<p>让其中一个收割者自杀。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Game.creeps[&#x27;Builder52477994&#x27;].suicide()</span><br></pre></td></tr></table></figure>

<p>这里有一点很重要，那就是死亡蠕虫的内存不会被清除，而是会保留下来以供以后再次使用。如果每次创建的蠕虫名称都是随机的，可能会导致内存溢出，因此应在每个 tick 开始时（蠕虫创建代码之前）清除内存。</p>
<p>添加清除内存的代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = require(&#x27;role.harvester&#x27;);</span><br><span class="line">var roleUpgrader = require(&#x27;role.upgrader&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports.loop = function () &#123;</span><br><span class="line"></span><br><span class="line">    module.exports = roleHarvester;</span><br><span class="line"></span><br><span class="line">    for(var name in Game.creeps) &#123;</span><br><span class="line">        var creep = Game.creeps[name];</span><br><span class="line">        if(creep.memory.role == &#x27;harvester&#x27;) &#123;</span><br><span class="line">            roleHarvester.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">        if(creep.memory.role == &#x27;upgrader&#x27;) &#123;</span><br><span class="line">            roleUpgrader.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，逝者的记忆已被遗忘，这为我们节省了资源。</p>
<p>除了在旧的蠕虫死亡后创建新的蠕虫外，还有另一种方法可以保持所需的蠕虫数量：StructureSpawn.renewCreep 方法。蠕虫老化在教程中是禁用的，因此我们建议您自行熟悉。</p>
<h3 id="5-防御"><a href="#5-防御" class="headerlink" title="5.防御"></a>5.防御</h3><p>抵御攻击的最可靠方法就是使用房间安全模式。在安全模式下，其他蠕虫无法在房间里使用任何有害的方法（但你仍然可以抵御陌生人的攻击）。</p>
<p>安全模式是通过房间控制器激活的，控制器上应该有可供使用的激活程序。让我们用一次激活来打开我们房间的安全模式。</p>
<p>激活安全模式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Game.spawns[&#x27;Spawn1&#x27;].room.controller.activateSafeMode();</span><br></pre></td></tr></table></figure>

<p>塔楼是主动防御房间的最简单方法。它们使用能量，可以瞄准房间中的任何小兵进行攻击或治疗。效果取决于塔与目标之间的距离。</p>
<p>首先，让我们为新塔打下基础。您可以在墙内设置任何您想设置的地方，并借助上面板上的 “建造 “按钮在那里放置建筑工地。</p>
<p>放置塔楼的建筑工地（手动或使用下面的代码）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Game.spawns[&#x27;Spawn1&#x27;].room.createConstructionSite( 23, 22, STRUCTURE_TOWER );</span><br></pre></td></tr></table></figure>

<p>高塔会消耗能量，因此我们要设置收割机的角色，让它与其他结构物一起为高塔提供能量。为此，您需要在收割机针对的结构过滤器中添加 STRUCTURE_TOWER 常量。</p>
<p>将 STRUCTURE_TOWER 添加到模块 role.harvester 中，然后等待能量出现在塔中。</p>
<p>role.harvester</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = &#123;</span><br><span class="line"></span><br><span class="line">    /** @param &#123;Creep&#125; creep **/</span><br><span class="line">    run: function(creep) &#123;</span><br><span class="line">	    if(creep.store.getFreeCapacity() &gt; 0) &#123;</span><br><span class="line">            var sources = creep.room.find(FIND_SOURCES);</span><br><span class="line">            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                creep.moveTo(sources[0], &#123;visualizePathStyle: &#123;stroke: &#x27;#ffaa00&#x27;&#125;&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            var targets = creep.room.find(FIND_STRUCTURES, &#123;</span><br><span class="line">                    filter: (structure) =&gt; &#123;</span><br><span class="line">                        return (structure.structureType == STRUCTURE_EXTENSION ||</span><br><span class="line">                                structure.structureType == STRUCTURE_SPAWN ||</span><br><span class="line">                                structure.structureType == STRUCTURE_TOWER) &amp;&amp; </span><br><span class="line">                                structure.store.getFreeCapacity(RESOURCE_ENERGY) &gt; 0;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            if(targets.length &gt; 0) &#123;</span><br><span class="line">                if(creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) &#123;</span><br><span class="line">                    creep.moveTo(targets[0], &#123;visualizePathStyle: &#123;stroke: &#x27;#ffffff&#x27;&#125;&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module.exports = roleHarvester;</span><br></pre></td></tr></table></figure>

<p>很好，你的塔已经可以使用了！</p>
<p>和爬行一样，塔也有几种类似的方法：攻击、治疗和修复。每次行动消耗 10 个能量单位。我们需要在发现最近的敌人蠕虫时对其使用攻击。请记住，距离是至关重要的：相同的能量消耗下，效果可以强数倍！</p>
<p>要直接获取塔楼对象，可以使用右侧面板中的 ID 和 Game.getObjectById 方法。</p>
<p>在塔的帮助下摧毁敌人的小兵。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = require(&#x27;role.harvester&#x27;);</span><br><span class="line">var roleUpgrader = require(&#x27;role.upgrader&#x27;);</span><br><span class="line">var roleBuilder = require(&#x27;role.builder&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports.loop = function () &#123;</span><br><span class="line"></span><br><span class="line">    var tower = Game.getObjectById(&#x27;e24e85f11ef1ef37ef3d24a1&#x27;);</span><br><span class="line">    if(tower) &#123;</span><br><span class="line">        var closestHostile = tower.pos.findClosestByRange(FIND_HOSTILE_CREEPS);</span><br><span class="line">        if(closestHostile) &#123;</span><br><span class="line">            tower.attack(closestHostile);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for(var name in Game.creeps) &#123;</span><br><span class="line">        var creep = Game.creeps[name];</span><br><span class="line">        if(creep.memory.role == &#x27;harvester&#x27;) &#123;</span><br><span class="line">            roleHarvester.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">        if(creep.memory.role == &#x27;upgrader&#x27;) &#123;</span><br><span class="line">            roleUpgrader.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">        if(creep.memory.role == &#x27;builder&#x27;) &#123;</span><br><span class="line">            roleBuilder.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>敌人的小兵被消灭了，我们的殖民地可以松口气了。不过，入侵者在短暂的攻击中损坏了一些墙壁。你最好设置自动修复功能。</p>
<p>小兵和防御塔都可以修复损坏的建筑。让我们尝试用塔来修复。我们需要使用方法 repair。你还需要 Room.find 方法和一个过滤器来定位损坏的墙壁。</p>
<p>请注意，由于墙壁不属于任何玩家，因此查找它们需要使用常量 FIND_STRUCTURES，而不是 FIND_MY_STRUCTURES。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester = require(&#x27;role.harvester&#x27;);</span><br><span class="line">var roleUpgrader = require(&#x27;role.upgrader&#x27;);</span><br><span class="line">var roleBuilder = require(&#x27;role.builder&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports.loop = function () &#123;</span><br><span class="line"></span><br><span class="line">    var tower = Game.getObjectById(&#x27;e24e85f11ef1ef37ef3d24a1&#x27;);</span><br><span class="line">    if(tower) &#123;</span><br><span class="line">        var closestDamagedStructure = tower.pos.findClosestByRange(FIND_STRUCTURES, &#123;</span><br><span class="line">            filter: (structure) =&gt; structure.hits &lt; structure.hitsMax</span><br><span class="line">        &#125;);</span><br><span class="line">        if(closestDamagedStructure) &#123;</span><br><span class="line">            tower.repair(closestDamagedStructure);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var closestHostile = tower.pos.findClosestByRange(FIND_HOSTILE_CREEPS);</span><br><span class="line">        if(closestHostile) &#123;</span><br><span class="line">            tower.attack(closestHostile);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for(var name in Game.creeps) &#123;</span><br><span class="line">        var creep = Game.creeps[name];</span><br><span class="line">        if(creep.memory.role == &#x27;harvester&#x27;) &#123;</span><br><span class="line">            roleHarvester.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">        if(creep.memory.role == &#x27;upgrader&#x27;) &#123;</span><br><span class="line">            roleUpgrader.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">        if(creep.memory.role == &#x27;builder&#x27;) &#123;</span><br><span class="line">            roleBuilder.run(creep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="else"><a href="#else" class="headerlink" title="else"></a>else</h1><h4 id="采矿"><a href="#采矿" class="headerlink" title="采矿"></a>采矿</h4><p>采矿的让他一直在矿上采集，用transfer运矿</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Game.spawns[&#x27;Spawn1&#x27;].spawnCreep([WORK,CARRY,MOVE,MOVE,MOVE], u, </span><br><span class="line">                &#123;memory: &#123;role: &#x27;bigharvester&#x27;&#125;&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="造extension"><a href="#造extension" class="headerlink" title="造extension"></a>造extension</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for (var i = 25; i &lt;= 29; i++) &#123;</span><br><span class="line">   Game.spawns[&#x27;Spawn1&#x27;].room.createConstructionSite(26, 25, STRUCTURE_EXTENSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Game.spawns[&#x27;Spawn1&#x27;].room.createConstructionSite(26, 25, STRUCTURE_EXTENSION);</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="Nooby-Guide"><a href="#Nooby-Guide" class="headerlink" title="Nooby Guide"></a>Nooby Guide</h1><ul>
<li><p>调用module</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var roleHarvester=require(&#x27;role.harvester&#x27;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过creep的name调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for(let name in Game.creeps)&#123;</span><br><span class="line">	var creep = Game.creeps[name];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成harvester</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var name=Game.spawns.Spawn1.createCreep([WORK,WORK,CARRY,WORK], undefined,&#123;role: &#x27;harvester&#x27;,working:false&#125;);</span><br><span class="line">//输出名字</span><br><span class="line">if(!(name &lt; 0))&#123;</span><br><span class="line">	console.log(&quot;spawning new creep: &quot;+ name);</span><br><span class="line">&#125;</span><br><span class="line">//js里比较string和int会一直返回false</span><br></pre></td></tr></table></figure>
</li>
<li><p>harvester参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var minHarvesterNum=10</span><br><span class="line">var numberOfHarvester = _.sum(Game.creeps, (c) =&gt; c.memory.role ==&#x27;harvester&#x27;);</span><br><span class="line">console.log(numberOfHarvester)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="build-structure"><a href="#build-structure" class="headerlink" title="build structure"></a>build structure</h3><p>- </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/10/11/ssh%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/10/11/ssh%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url">ssh远程服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-10-11T20:55:19+08:00">
                2023-10-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="NVIDIA"><a href="#NVIDIA" class="headerlink" title="NVIDIA"></a>NVIDIA</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi -loop 5</span><br></pre></td></tr></table></figure>

<p>隔5秒打印一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h1><p>openssh生成公钥私钥</p>
<p>公钥放到远程文件夹</p>
<h1 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate nlp_deploy &amp;&amp; cd HQ/FocalNet/</span><br></pre></td></tr></table></figure>

<h1 id="tmux"><a href="#tmux" class="headerlink" title="tmux"></a>tmux</h1><p>列出对话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmux list-sessions</span><br></pre></td></tr></table></figure>

<p>回到对话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmux attach-session -t</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmux attach-session -t your-session-name</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tmux new-session -s session-name  # 创建一个新会话并为其指定名称</span><br><span class="line">tmux rename-session -t old-session-name new-session-name  # 重命名会话的名称</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>打开鼠标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmux setw -g mouse on</span><br></pre></td></tr></table></figure>



<p>train-1011</p>
<p>实验室V100</p>
<p>tmux</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train exp3，大的那个focalnet_tiny_lrf_sparsercnn_3x</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train-base exp2，base那个focalnet_base_lrf device1 lrf效果不好</span><br><span class="line">train-base exp7，base那个focalnet_base_srf device 1 用srf</span><br></pre></td></tr></table></figure>

<p>本地笔记本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">focalnet_tiny_lrf exp3</span><br></pre></td></tr></table></figure>

<p>实验室3070</p>
<p>1011晚上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">focalnet_tiny_srf exp</span><br></pre></td></tr></table></figure>

<p>1012早上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">focalnet_tiny_srf exp3</span><br></pre></td></tr></table></figure>





<p>/home/gv1001107/HQ/FocalNet/runs/train/exp2/weights/last.pt</p>
<p>yolo原始模型</p>
<p><img src="/2023/10/11/ssh%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/image-20231012145854953.png" alt="image-20231012145854953"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/10/09/yolo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/10/09/yolo/" itemprop="url">yolo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-10-09T19:24:17+08:00">
                2023-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><h3 id="官方项目"><a href="#官方项目" class="headerlink" title="官方项目"></a>官方项目</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ultralytics/yolov5</span><br></pre></td></tr></table></figure>

<p>用哪个模型就把<code>.pt</code>模型下载下来放到models文件夹</p>
<p><img src="/2023/10/09/yolo/image-20231009192605348.png" alt="image-20231009192605348"></p>
<h3 id="video"><a href="#video" class="headerlink" title="video"></a>video</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1tM411a7it/?spm_id_from=333.999.0.0&amp;vd_source=3d040baeb67aeceb2bba9c7169a67a96">https://www.bilibili.com/video/BV1tM411a7it/?spm_id_from=333.999.0.0&amp;vd_source=3d040baeb67aeceb2bba9c7169a67a96</a></p>
<h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/z1069614715/objectdetection_script/tree/master/yolo</span><br></pre></td></tr></table></figure>

<h3 id="dataset"><a href="#dataset" class="headerlink" title="dataset"></a>dataset</h3><p>type:</p>
<ul>
<li>VOC<ul>
<li>xml2txt.py<ul>
<li>postfix-&gt; image type, jpg or png</li>
<li>image, xml, txt path</li>
<li>run: python xml2txt.py</li>
</ul>
</li>
</ul>
</li>
<li>yolo格式直接改这个<ul>
<li>data.yaml<ul>
<li>类别数nc</li>
<li>类别名称names</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="train"><a href="#train" class="headerlink" title="train"></a>train</h3><p>设置参数，快速上手</p>
<p>weight权重，刚才下载的yolov5n.pt</p>
<p>cfg配置文件，models里面，对应权重</p>
<p>data，数据集文件</p>
<p>hyp，超参数</p>
<p>epoch</p>
<p>device，显卡，cpu</p>
<p>worker，线程，可以填0（慢，但不会报错）</p>
<p>改完就可以训练了</p>
<p>训练好的权重可以在runs/train/exp/weights下找到</p>
<h3 id="validation"><a href="#validation" class="headerlink" title="validation"></a>validation</h3><p>导入训练好的权重（改weight）</p>
<p>精度：数据集很密集，调iou-thres</p>
<p>task</p>
<h1 id="预测"><a href="#预测" class="headerlink" title="预测"></a>预测</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ python segment/predict.py --weights yolov5s-seg.pt --source 0                               # webcam</span><br><span class="line">                                                              img.jpg                         # image</span><br><span class="line">                                                              vid.mp4                         # video</span><br><span class="line">                                                              screen                          # screenshot</span><br><span class="line">                                                              path/                           # directory</span><br><span class="line">                                                              list.txt                        # list of images</span><br><span class="line">                                                              list.streams                    # list of streams</span><br><span class="line">                                                              &#x27;path/*.jpg&#x27;                    # glob</span><br><span class="line">                                                              &#x27;https://youtu.be/LNwODJXcvt4&#x27;  # YouTube</span><br><span class="line">                                                              &#x27;rtsp://example.com/media.mp4&#x27;  # RTSP, RTMP, HTTP stream</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/10/08/docker+FocalNet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/10/08/docker+FocalNet/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-10-08T22:53:12+08:00">
                2023-10-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="docker-FocalNet"><a href="#docker-FocalNet" class="headerlink" title="docker+FocalNet"></a>docker+FocalNet</h1><h1 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h1><p>拉取cuda11.7</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nvidia/cuda:11.7.1-devel-ubuntu22.04</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/572320455">https://zhuanlan.zhihu.com/p/572320455</a></p>
<p>运行容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --gpus all nvidia/cuda:11.0.3-base-ubuntu20.04 nvidia-smi</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm --name test --gpus all ubuntu:latest</span><br></pre></td></tr></table></figure>

<p>配置环境</p>
<p>注意：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/linhaifeng/p/16108285.html">https://www.cnblogs.com/linhaifeng/p/16108285.html</a></p>
<p>\1. 显卡驱动在所有方式中，都要先安装好，容器是不会有显卡驱动的，一台物理机的显卡只对应一个显卡驱动，当显卡驱动安装好后（即使未安装cuda），也可以使用命令nvidia-smi</p>
<p>\2. nvidia-smi显示的是显卡驱动对应的cuda版本，nvcc -V 显示的运行是cuda的版本<br>补充</p>
<h3 id="pytorch"><a href="#pytorch" class="headerlink" title="pytorch"></a>pytorch</h3><h5 id="拉取"><a href="#拉取" class="headerlink" title="拉取"></a>拉取</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime</span><br></pre></td></tr></table></figure>

<h5 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --gpus all -it --name pytorch_env pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime /bin/bash</span><br></pre></td></tr></table></figure>

<h5 id="4-设置映射目录"><a href="#4-设置映射目录" class="headerlink" title="4.设置映射目录"></a>4.设置映射目录</h5><p>在容器中，我们通常需要读取外部主机文件，因此需要在启动时指定映射目录。下面我们将把主机上的/home/user/data目录映射到容器的/data目录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --gpus all -it \</span><br><span class="line">--name railway_detect \</span><br><span class="line">-v C:\Users\74420\Desktop\yolo\railwaydetect\input:/usr/local/serving/input/ \</span><br><span class="line">-v C:\Users\74420\Desktop\yolo\railwaydetect\:/usr/local/railwaydetect/ \</span><br><span class="line">pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime \</span><br><span class="line">/bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --gpus all -it `</span><br><span class="line">--name bjgydax_test `</span><br><span class="line">-v C:\Users\74420\Desktop\yolo\railwaydetect\input: /usr/local/serving/input/ `</span><br><span class="line">-v C:\Users\74420\Desktop\yolo\bjgydax\:/usr/local/railwaydetect/ `</span><br><span class="line">bjgydax:latest `</span><br><span class="line">/bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h5 id="5-进入容器"><a href="#5-进入容器" class="headerlink" title="5.进入容器"></a>5.进入容器</h5><p>最后，我们使用docker exec命令进入容器。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it --rm --gpus all pytorch_test /bin/bash</span><br></pre></td></tr></table></figure>



<h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --gpus all -it --name railway_detect -v C:\Users\74420\Desktop\yolo\railwaydetect\input:/usr/local/serving/input/ railway-detect /bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run --rm --gpus all -it `</span><br><span class="line">--name railway_detect `</span><br><span class="line">-v C:\Users\74420\Desktop\yolo\railwaydetect\input:/usr/local/serving/input/ `</span><br><span class="line">railway-detect `</span><br><span class="line">/bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h3><p>更换Ubuntu的软件源可以帮助加速软件包的下载和更新，同时也可以解决一些网络访问问题。以下是在Ubuntu上更换软件源的一般步骤：</p>
<p><strong>请注意：在更换软件源之前，请确保备份系统数据，以防发生意外情况。</strong></p>
<ol>
<li><p><strong>备份源列表文件</strong>：</p>
<p>在更改软件源之前，首先备份你的源列表文件，以便在需要时恢复到默认设置。你可以使用以下命令备份源列表文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup</span><br></pre></td></tr></table></figure>

<p><strong>选择新的源</strong>：</p>
<p>你可以根据你的地理位置和网络情况选择一个合适的Ubuntu软件源。以下是一些常见的软件源：</p>
<ul>
<li>默认源（官方源）：默认情况下，Ubuntu使用官方源，通常速度较慢。</li>
<li>阿里云源：适用于中国大陆用户，提供了更快的下载速度。</li>
<li>清华大学源：提供了较快的下载速度和稳定的服务。</li>
</ul>
<p><strong>编辑源列表文件</strong>：</p>
<p>使用文本编辑器（例如<code>nano</code>或<code>vim</code>）来编辑源列表文件。以下是编辑源列表文件的示例命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure>

<p>在编辑器中，将原来的源替换为你选择的新源。例如，如果要使用阿里云源，可以将以下行添加到文件中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"># 预发布软件源，不建议启用</span><br><span class="line"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>请根据你选择的源进行相应的修改。</p>
<p><strong>更新软件包信息</strong>：</p>
<p>保存源列表文件后，运行以下命令来更新软件包信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>这将从新的源获取软件包信息。</p>
<p><strong>升级系统</strong>：</p>
<p>如果需要，你可以运行以下命令来升级系统中的所有软件包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure>

<p>这将安装新的软件包版本。</p>
<p>完成以上步骤后，你的Ubuntu系统将使用你选择的新软件源来获取软件包。请注意，根据你的地理位置和网络情况，不同的源可能会有不同的速度和可用性。如果在使用新源后遇到问题，你可以随时恢复到默认的官方源，方法是将备份的源列表文件恢复到<code>/etc/apt/sources.list</code></p>
<h5 id="待安装包"><a href="#待安装包" class="headerlink" title="待安装包"></a>待安装包</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install vim &amp;&amp;</span><br><span class="line">apt install docker &amp;&amp;</span><br><span class="line">apt install git &amp;&amp;</span><br></pre></td></tr></table></figure>



<h3 id="项目迁移"><a href="#项目迁移" class="headerlink" title="项目迁移"></a>项目迁移</h3><h5 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h5><h5 id="复制到容器本地"><a href="#复制到容器本地" class="headerlink" title="复制到容器本地"></a>复制到容器本地</h5><h3 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h3><p>清空文件夹单独增加一个模块def refresh_output():</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def refresh_output():</span><br><span class="line"></span><br><span class="line">    directory_path=ROOT / &#x27;output&#x27;</span><br><span class="line">    def delete_contents_of_directory(directory_path):</span><br><span class="line">        try:</span><br><span class="line">            for item in os.listdir(directory_path):</span><br><span class="line">                item_path = os.path.join(directory_path, item)</span><br><span class="line">                if os.path.isfile(item_path):</span><br><span class="line">                    os.remove(item_path)</span><br><span class="line">                elif os.path.isdir(item_path):</span><br><span class="line">                    shutil.rmtree(item_path)</span><br><span class="line">            print(f&quot;Deleted all contents of directory: &#123;directory_path&#125;&quot;)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(f&quot;An error occurred: &#123;str(e)&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 要删除的目录路径</span><br><span class="line">    directory_to_clear = &quot;output&quot;  # 请替换为你的目录路径</span><br><span class="line"></span><br><span class="line">    # 调用函数来删除目录下的所有内容</span><br><span class="line">    delete_contents_of_directory(directory_to_clear)</span><br></pre></td></tr></table></figure>

<p>输出格式，统一txt和jpg文件名，放到images和labels两个文件夹里面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">def output():</span><br><span class="line"></span><br><span class="line">    # 指定图片所在目录和标签所在目录</span><br><span class="line">    image_dir = ROOT / &#x27;output&#x27;  # 指定图片所在目录</span><br><span class="line">    label_dir = ROOT / &#x27;output/labels&#x27;  # 指定标签所在目录</span><br><span class="line"></span><br><span class="line">    # 确保images目录存在，如果不存在则创建</span><br><span class="line">    images_output_dir = os.path.join(image_dir, &quot;images&quot;)</span><br><span class="line">    os.makedirs(images_output_dir, exist_ok=True)</span><br><span class="line"></span><br><span class="line">    # 获取所有jpg文件</span><br><span class="line">    jpg_files = [f for f in os.listdir(image_dir) if f.endswith(&quot;.jpg&quot;)]</span><br><span class="line"></span><br><span class="line">    # 遍历所有jpg文件</span><br><span class="line">    for jpg_file in jpg_files:</span><br><span class="line">        # 构建对应的txt文件名</span><br><span class="line">        txt_file = os.path.splitext(jpg_file)[0] + &quot;.txt&quot;</span><br><span class="line">        txt_file_path = os.path.join(label_dir, txt_file)</span><br><span class="line"></span><br><span class="line">        # 移动jpg文件到images目录下</span><br><span class="line">        src_jpg_path = os.path.join(image_dir, jpg_file)</span><br><span class="line">        dest_jpg_path = os.path.join(images_output_dir, jpg_file)</span><br><span class="line">        shutil.move(src_jpg_path, dest_jpg_path)</span><br><span class="line"></span><br><span class="line">        # 如果对应的txt文件不存在，则创建一个空的txt文件</span><br><span class="line">        if not os.path.exists(txt_file_path):</span><br><span class="line">            open(txt_file_path, &#x27;w&#x27;).close()</span><br></pre></td></tr></table></figure>



<p>路径修改下面三个parser</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(&#x27;--project&#x27;, default=ROOT / &#x27;runs/detect&#x27;, help=&#x27;save results to project/name&#x27;)</span><br><span class="line">parser.add_argument(&#x27;--name&#x27;, default=&#x27;exp&#x27;, help=&#x27;save results to project/name&#x27;)</span><br><span class="line">parser.add_argument(&#x27;--exist-ok&#x27;, action=&#x27;store_true&#x27;, help=&#x27;existing project/name ok, do not increment&#x27;)</span><br></pre></td></tr></table></figure>



<h3 id="docker-save"><a href="#docker-save" class="headerlink" title="docker save"></a>docker save</h3><p>先打包成image</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit 7d8f railway-detect</span><br></pre></td></tr></table></figure>

<p>再save到本地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o C:\Users\74420\Desktop\railway-detect.tar railway-detect</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o C:\Users\74420\Desktop\bjgydax.tar bjgydax</span><br></pre></td></tr></table></figure>







<h1 id="FocalNet"><a href="#FocalNet" class="headerlink" title="FocalNet"></a>FocalNet</h1><h2 id="YOLOV5改进-具有焦点调制模块的FocalNet"><a href="#YOLOV5改进-具有焦点调制模块的FocalNet" class="headerlink" title="YOLOV5改进-具有焦点调制模块的FocalNet"></a>YOLOV5改进-具有焦点调制模块的FocalNet</h2><p> <a target="_blank" rel="noopener" href="https://b23.tv/57o5eTk">https://b23.tv/57o5eTk</a></p>
<h2 id="官方项目"><a href="#官方项目" class="headerlink" title="官方项目"></a>官方项目</h2><h3 id="win下socket有问题，转到linux下"><a href="#win下socket有问题，转到linux下" class="headerlink" title="win下socket有问题，转到linux下"></a>win下socket有问题，转到linux下</h3><p>把项目挂载过去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp C:\Users\74420\Desktop\focalnet 582d:/workspace/focalnet</span><br></pre></td></tr></table></figure>

<p>仍然有问题，amp配置不好</p>
<h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><p>To evaluate a pre-trained FocalNets on ImageNet val, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m torch.distributed.launch --nproc_per_node &lt;num-of-gpus-to-use&gt; --master_port 12345 main.py --eval --cfg &lt;config-file&gt; --resume &lt;checkpoint&gt; --data-path &lt;imagenet-path&gt; </span><br></pre></td></tr></table></figure>

<p>​    </p>
<p>For example, to evaluate the <code>FocalNet-B</code> with a single GPU:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m torch.distributed.launch --nproc_per_node 1 --master_port 12345 main.py --eval --cfg configs/focalnet_base_srf.yaml --resume focalnet_base_srf.pth --data-path &lt;imagenet-path&gt;</span><br></pre></td></tr></table></figure>

<p>​    </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m torch.distributed.launch --nproc_per_node 1 --master_port 12345 main.py --eval --cfg configs/focalnet_base_srf.yaml --resume focalnet_base_srf.pth --data-path C:\Users\74420\Desktop\focalnet\dataset\dataset_1010</span><br></pre></td></tr></table></figure>





<h1 id="yolo"><a href="#yolo" class="headerlink" title="yolo"></a>yolo</h1><h2 id="model"><a href="#model" class="headerlink" title="model"></a>model</h2><p>best model</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\ST_train_LBN\yolov5-6.1-backbone\runs\train\finetune_pruned_exp\competation_yolov5m\weights</span><br></pre></td></tr></table></figure>



<p>augmentations.py/letterbox</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"># Process predictions</span><br><span class="line">       for i, det in enumerate(pred):  # per image</span><br><span class="line">           seen += 1</span><br><span class="line">           if webcam:  # batch_size &gt;= 1</span><br><span class="line">               p, im0, frame = path[i], im0s[i].copy(), dataset.count</span><br><span class="line">               s += f&#x27;&#123;i&#125;: &#x27;</span><br><span class="line">           else:</span><br><span class="line">               p, im0, frame = path, im0s.copy(), getattr(dataset, &#x27;frame&#x27;, 0)</span><br><span class="line"></span><br><span class="line">           p = Path(p)  # to Path</span><br><span class="line">           save_path = str(save_dir / p.name)  # im.jpg</span><br><span class="line">           txt_path = str(save_dir / &#x27;labels&#x27; / p.stem) + (&#x27;&#x27; if dataset.mode == &#x27;image&#x27; else f&#x27;_&#123;frame&#125;&#x27;)  # im.txt</span><br><span class="line">           s += &#x27;%gx%g &#x27; % im.shape[2:]  # print string</span><br><span class="line">           imc = im0.copy() if save_crop else im0  # for save_crop</span><br><span class="line">           annotator = Annotator(im0, line_width=line_thickness, example=str(names))</span><br><span class="line">           if len(det):</span><br><span class="line">               if retina_masks:</span><br><span class="line">                   # scale bbox first the crop masks</span><br><span class="line">                   det[:, :4] = scale_boxes(im.shape[2:], det[:, :4], im0.shape).round()  # rescale boxes to im0 size</span><br><span class="line">                   masks = process_mask_native(proto[i], det[:, 6:], det[:, :4], im0.shape[:2])  # HWC</span><br><span class="line">               else:</span><br><span class="line">                   masks = process_mask(proto[i], det[:, 6:], det[:, :4], im.shape[2:], upsample=True)  # HWC</span><br><span class="line">                   det[:, :4] = scale_boxes(im.shape[2:], det[:, :4], im0.shape).round()  # rescale boxes to im0 size</span><br><span class="line"></span><br><span class="line">               # Segments</span><br><span class="line">               if save_txt:</span><br><span class="line">                   segments = [</span><br><span class="line">                       scale_segments(im0.shape if retina_masks else im.shape[2:], x, im0.shape, normalize=True)</span><br><span class="line">                       for x in reversed(masks2segments(masks))]</span><br><span class="line"></span><br><span class="line">               # Print results</span><br><span class="line">               for c in det[:, 5].unique():</span><br><span class="line">                   n = (det[:, 5] == c).sum()  # detections per class</span><br><span class="line">                   s += f&quot;&#123;n&#125; &#123;names[int(c)]&#125;&#123;&#x27;s&#x27; * (n &gt; 1)&#125;, &quot;  # add to string</span><br><span class="line"></span><br><span class="line">               # Mask plotting</span><br><span class="line">               annotator.masks(</span><br><span class="line">                   masks,</span><br><span class="line">                   colors=[colors(x, True) for x in det[:, 5]],</span><br><span class="line">                   im_gpu=torch.as_tensor(im0, dtype=torch.float16).to(device).permute(2, 0, 1).flip(0).contiguous() /</span><br><span class="line">                   255 if retina_masks else im[i])</span><br><span class="line"></span><br><span class="line">               # Write results</span><br><span class="line">               for j, (*xyxy, conf, cls) in enumerate(reversed(det[:, :6])):</span><br><span class="line">                   if save_txt:  # Write to file</span><br><span class="line">                       seg = segments[j].reshape(-1)  # (n,2) to (n*2)</span><br><span class="line">                       line = (cls, *seg, conf) if save_conf else (cls, *seg)  # label format</span><br><span class="line">                       with open(f&#x27;&#123;txt_path&#125;.txt&#x27;, &#x27;a&#x27;) as f:</span><br><span class="line">                           f.write((&#x27;%g &#x27; * len(line)).rstrip() % line + &#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">                   if save_img or save_crop or view_img:  # Add bbox to image</span><br><span class="line">                       c = int(cls)  # integer class</span><br><span class="line">                       label = None if hide_labels else (names[c] if hide_conf else f&#x27;&#123;names[c]&#125; &#123;conf:.2f&#125;&#x27;)</span><br><span class="line">                       annotator.box_label(xyxy, label, color=colors(c, True))</span><br><span class="line">                       # annotator.draw.polygon(segments[j], outline=colors(c, True), width=3)</span><br><span class="line">                   if save_crop:</span><br><span class="line">                       save_one_box(xyxy, imc, file=save_dir / &#x27;crops&#x27; / names[c] / f&#x27;&#123;p.stem&#125;.jpg&#x27;, BGR=True)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="try"><a href="#try" class="headerlink" title="try"></a>try</h2><p>输出txt：</p>
<p>predict.py parser –save-txt default true</p>
<p>save-conf true 置信度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parser.add_argument(&#x27;--save-txt&#x27;, default=True, help=&#x27;save results to *.txt&#x27;)</span><br><span class="line">parser.add_argument(&#x27;--save-conf&#x27;, default=True, help=&#x27;save confidences in --save-txt labels&#x27;)</span><br></pre></td></tr></table></figure>



<p>修改输出坐标</p>
<p>detect.py or predict.py</p>
<p>不输出seg，输出xyxy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># Write results</span><br><span class="line">                for j, (*xyxy, conf, cls) in enumerate(reversed(det[:, :6])):</span><br><span class="line">                    # xyxy是目标坐标x1y1,x2y2，左上角0,0</span><br><span class="line">                    if save_txt:  # Write to file</span><br><span class="line">                        seg = segments[j].reshape(-1)  # (n,2) to (n*2)</span><br><span class="line">                        line0 = (cls, *seg, conf) if save_conf else (cls, *seg)  # label format</span><br><span class="line">                        # with open(f&#x27;&#123;txt_path&#125;.txt&#x27;, &#x27;a&#x27;) as f:</span><br><span class="line">                        #     f.write((&#x27;%g &#x27; * len(line)).rstrip() % line + &#x27;\n&#x27;)</span><br><span class="line">                        # 上面的line:cls类别，seg目标的分割信息，目标的边界框/轮廓，conf置信度，需要将save_conf设为TRUE</span><br><span class="line"></span><br><span class="line">                        line = (cls, *xyxy, conf) if save_conf else (cls, *xyxy)</span><br><span class="line">                        with open(f&#x27;&#123;txt_path&#125;.txt&#x27;, &#x27;a&#x27;) as f:</span><br><span class="line">                            formatted_line = &#x27; &#x27;.join([&#x27;%g&#x27; % item for item in line]) + &#x27;\n&#x27;</span><br><span class="line">                            f.write(formatted_line)</span><br><span class="line"></span><br><span class="line">                    if save_img or save_crop or view_img:  # Add bbox to image</span><br><span class="line">                        c = int(cls)  # integer class</span><br><span class="line">                        label = None if hide_labels else (names[c] if hide_conf else f&#x27;&#123;names[c]&#125; &#123;conf:.2f&#125;&#x27;)</span><br><span class="line">                        annotator.box_label(xyxy, label, color=colors(c, True))</span><br><span class="line">                        # annotator.draw.polygon(segments[j], outline=colors(c, True), width=3)</span><br><span class="line">                    if save_crop:</span><br><span class="line">                        save_one_box(xyxy, imc, file=save_dir / &#x27;crops&#x27; / names[c] / f&#x27;&#123;p.stem&#125;.jpg&#x27;, BGR=True)</span><br></pre></td></tr></table></figure>



<h2 id="预测"><a href="#预测" class="headerlink" title="预测"></a>预测</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ python segment/predict.py --weights yolov5s-seg.pt --source 0                               # webcam</span><br><span class="line">                                                              img.jpg                         # image</span><br><span class="line">                                                              vid.mp4                         # video</span><br><span class="line">                                                              screen                          # screenshot</span><br><span class="line">                                                              path/                           # directory</span><br><span class="line">                                                              list.txt                        # list of images</span><br><span class="line">                                                              list.streams                    # list of streams</span><br><span class="line">                                                              &#x27;path/*.jpg&#x27;                    # glob</span><br><span class="line">                                                              &#x27;https://youtu.be/LNwODJXcvt4&#x27;  # YouTube</span><br><span class="line">                                                              &#x27;rtsp://example.com/media.mp4&#x27;  # RTSP, RTMP, HTTP stream</span><br></pre></td></tr></table></figure>



<h2 id="文件目录"><a href="#文件目录" class="headerlink" title="文件目录"></a>文件目录</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/serving</span><br></pre></td></tr></table></figure>

<p>把项目拉到这里，输入输出自然就在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/serving/input</span><br><span class="line">/usr/local/serving/output/images</span><br><span class="line">/usr/local/serving/output/labels</span><br></pre></td></tr></table></figure>



<h2 id="运行命令："><a href="#运行命令：" class="headerlink" title="运行命令："></a>运行命令：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/serving/ &amp;&amp; </span><br><span class="line">python3 detect.py</span><br></pre></td></tr></table></figure>



<h2 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h2><p><img src="/2023/10/08/docker+FocalNet/image-20231010191218938.png" alt="image-20231010191218938"></p>
<p>HQ:<br>输入指令：cd /usr/local/serving/ &amp;&amp; python3 detect.py</p>
<p>HQ:<br>输出图像：带目标框的检测效果图保存至<br>/usr/local/serving/output/images</p>
<p>HQ:<br><img src="/2023/10/08/docker+FocalNet/image-20231010191236168.png" alt="image-20231010191236168"></p>
<p>HQ:<br>输出txt：若该图片中无目标，仍需保存原始图片和空 txt 文件，名称与图片名称保存一致<br>保存至/usr/local/serving/output/labels</p>
<p>HQ:<br><img src="/2023/10/08/docker+FocalNet/image-20231010191240185.png" alt="image-20231010191240185"></p>
<p>HQ:<br>标识：identifying.txt，保存至/usr/local/serving/output/</p>
<p>HQ:<br>输入文件夹：/usr/local/serving/input，目前挂载的宿主机文件夹</p>
<p>HQ:<br><img src="/2023/10/08/docker+FocalNet/image-20231010191244507.png" alt="image-20231010191244507"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://developer-hq.github.io/2023/10/07/HomeAssistant/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/10/07/HomeAssistant/" itemprop="url">HomeAssistant</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-10-07T15:49:48+08:00">
                2023-10-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv15944396/">https://www.bilibili.com/read/cv15944396/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/">
    
              
                  <span class="site-state-item-count">82</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
